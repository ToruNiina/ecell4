

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. Spatiocyte Simulations at Single-Molecule Resolution &mdash; E-Cell 4.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="E-Cell 4.0.0 documentation" href="../index.html"/>
        <link rel="next" title="E-Cell4 core API" href="../api/core.html"/>
        <link rel="prev" title="9. Spatial Gillespie Method" href="../tutorial9/tutorial9.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> E-Cell
          

          
          </a>

          
            
            
              <div class="version">
                4.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#installation-and-usage">Installation and usage</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial1/tutorial1.html">1. Brief Tour of E-Cell4 Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial2/tutorial2.html">2. How to Build a Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial3/tutorial3.html">3. How to Setup the Initial Condition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial4/tutorial4.html">4. How to Run a Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial5/tutorial5.html">5. How to Log and Visualize Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial6/tutorial6.html">6. How to Solve ODEs with Rate Law Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial7/tutorial7.html">7. Introduction of Rule-based Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial8/tutorial8.html">8. More about 1. Brief Tour of E-Cell4 Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial9/tutorial9.html">9. Spatial Gillespie Method</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">10. Spatiocyte Simulations at Single-Molecule Resolution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#spatiocyte-lattice-based-method">10.1. Spatiocyte Lattice-based Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-diffusion-movement-of-single-molecule">10.2. The Diffusion Movement of Single Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-diffusion-coefficient-and-the-second-order-reaction">10.3 The Diffusion Coefficient and the Second-order Reaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-structure-in-the-spatiocyte-method">10.4. The Structure in the Spatiocyte Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-structure-and-the-reaction">10.5 The structure and the reaction</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/core.html">E-Cell4 core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/gillespie.html">E-Cell4 gillespie API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/ode.html">E-Cell4 ode API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/meso.html">E-Cell4 meso API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/spatiocyte.html">E-Cell4 spatiocyte API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/bd.html">E-Cell4 bd API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/egfrd.html">E-Cell4 egfrd API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util.html">E-Cell4 util API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util.viz.html">E-Cell4 util.viz API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util.decorator.html">E-Cell4 util.decorator API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Attractors/Attractors.html">Attractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Drosophila/Drosophila.html">Drosophila Circadian Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DualPhospho/DualPhospho.html">Dual Phosphorylation Cycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glycolysis/Glycolysis.html">A Simple Model of the Glycolysis of Human Erythrocytes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HodgkinHuxley/HodgkinHuxley.html">Hodgkin-Huxley Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HodgkinHuxley/HodgkinHuxley.html#fitzhughnagumo-model">FitzHugh–Nagumo Model</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">E-Cell</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>10. Spatiocyte Simulations at Single-Molecule Resolution</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial10/tutorial10.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spatiocyte-simulations-at-single-molecule-resolution">
<h1>10. Spatiocyte Simulations at Single-Molecule Resolution<a class="headerlink" href="#spatiocyte-simulations-at-single-molecule-resolution" title="Permalink to this headline">¶</a></h1>
<p>We showed an example of E-Cell4 spatial representation.
Next let&#8217;s simulate the models with more detailed spatial representation called &#8220;single molecule resolution&#8221;.</p>
<div class="code python highlight-python"><div class="highlight"><pre>%matplotlib inline
from ecell4 import *
</pre></div>
</div>
<div class="section" id="spatiocyte-lattice-based-method">
<h2>10.1. Spatiocyte Lattice-based Method<a class="headerlink" href="#spatiocyte-lattice-based-method" title="Permalink to this headline">¶</a></h2>
<p>In spatical Gillespie method, we divided the <code class="docutils literal"><span class="pre">Space</span></code> into smaller
<code class="docutils literal"><span class="pre">Space</span></code>, then we diffuse the molecules in the subvolumes. However, we
treated the molecules in each subvolume just as the number of the
molecules, and the location of the molecules are NOT determinated.</p>
<p>In other words, the spatical resolution of spatical Gillespie method is
equal to the side of a subvolume <img class="math" src="../_images/math/d99efde75c84ef402a92cd4497530d2366fb112f.png" alt="l"/>. To improve this resolution,
we need to make the size of <img class="math" src="../_images/math/d99efde75c84ef402a92cd4497530d2366fb112f.png" alt="l"/> small. But in this method the
<img class="math" src="../_images/math/d99efde75c84ef402a92cd4497530d2366fb112f.png" alt="l"/> must be larger than the (at least) 10 times the diameter of
molecule <img class="math" src="../_images/math/9d86170e7de539c0ff999de09621ee0c7b6c8ed0.png" alt="R"/>.</p>
<p>How can we improve the spatical resolution to the size of the molecule?
The answer is the simulation with single-molecule resolution. This
method simulate the molecule not with the number of the molecules, but
with the spatical reaction diffusion of each molecule.</p>
<p>E-Cell4 has multiple single-molecule resolution method, here we explain
about Spatiocyte lattice-based method. Spatiocyte treats each molecule
as hard spheres, and diffuses the molecules on hexagonal close-packed
lattice.</p>
<p>Spatiocyte has an ID for each molecule and the position of the molecule
with single-molecule resolution. For the higher spatial resolution,
Spatiocyte has 100 times smaller time-step than spatical Gillespie,
because the time scale of diffusion increases with the square of the
distance.</p>
<p>Next, let&#8217;s try the Spatiocyte method.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="n">B</span> <span class="o">|</span> <span class="n">C</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="k">with</span> <span class="n">reaction_rules</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">==</span> <span class="n">C</span> <span class="o">|</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">)</span>  <span class="c1"># The second argument is &#39;voxel_radius&#39;.</span>
<span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteSimulator</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">FixedIntervalNumberObserver</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">))</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
<p>There is a distinct difference in the second argument for
<code class="docutils literal"><span class="pre">SpatiocyteWorld</span></code>. This is called <code class="docutils literal"><span class="pre">voxel</span> <span class="pre">radius</span></code>. Spatiocyte defines
the locations of the molecules with dividing the space with molecule
size, and call the minimum unit for this space as <code class="docutils literal"><span class="pre">Voxel</span></code>.</p>
<p>In most cases the size of the molecule would be good for
<code class="docutils literal"><span class="pre">voxel</span> <span class="pre">radius</span></code>. In this example, we set 5 <img class="math" src="../_images/math/86f8eac29c8dfb8d0ee92eebddabf2550bbd31b2.png" alt="\mathrm{nm}"/> as the
radius of the molecule in the space with the side 1
<img class="math" src="../_images/math/9e0ed82bcd4014a31af875f66c3a66a3b98a693a.png" alt="\mathrm{\mu m}"/> . It takes more time to simulate, but the result
is same with ODE or Gillespie.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_number_observer</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_5_01.png" src="../_images/output_5_01.png" />
</div>
<div class="section" id="the-diffusion-movement-of-single-molecule">
<h2>10.2. The Diffusion Movement of Single Molecule<a class="headerlink" href="#the-diffusion-movement-of-single-molecule" title="Permalink to this headline">¶</a></h2>
<p>Next let&#8217;s simulate single molecule diffusion to check the resolution.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">suc</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">new_particle</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="n">Real3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">new_particle</span></code> method places a particle to a coordinate in
<code class="docutils literal"><span class="pre">SpatiocyteWorld</span></code>, and returns the particle&#8217;s <code class="docutils literal"><span class="pre">ParticleID</span></code> (<code class="docutils literal"><span class="pre">pid</span></code>)
the information about the <code class="docutils literal"><span class="pre">Particle</span></code> (<code class="docutils literal"><span class="pre">p</span></code>), and verify whether the
particle is cooked with (<code class="docutils literal"><span class="pre">suc</span></code>). If a particle is already placed in
the coordinate, you can NOT place a particle over it and <code class="docutils literal"><span class="pre">suc</span></code> will be
<code class="docutils literal"><span class="pre">False</span></code> and fail.</p>
<p><code class="docutils literal"><span class="pre">p</span></code> contains the particle position, species type, radius, and
diffusion coefficient. You can inspect the <code class="docutils literal"><span class="pre">p</span></code> with the particle&#8217;s ID,
<code class="docutils literal"><span class="pre">pid</span></code>.</p>
<p>Let&#8217;s check <code class="docutils literal"><span class="pre">p</span></code> first.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pid</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">get_particle</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">species</span><span class="p">()</span><span class="o">.</span><span class="n">serial</span><span class="p">())</span>  <span class="c1"># must print: A</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">radius</span><span class="p">(),</span> <span class="n">p</span><span class="o">.</span><span class="n">D</span><span class="p">())</span>  <span class="c1"># must print: (0.005, 1.0)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">position</span><span class="p">()))</span>  <span class="c1"># must print: (0.49806291436591293, 0.49652123150307814, 0.5)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span>
<span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="p">(</span><span class="mf">0.49806291436591293</span><span class="p">,</span> <span class="mf">0.49652123150307814</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">get_particle</span></code> method receives a particle ID and returns the ID and
particle (of cource the ID are same with the given one). You can inspect
the coordinate of the particle as <code class="docutils literal"><span class="pre">Real3</span></code> with <code class="docutils literal"><span class="pre">position()</span></code> method.
It is hard to directly read the coordinate, here we printed it after
converting to tuple. As you can see the tuple coodinate is slightly
different from the original position given as a <code class="docutils literal"><span class="pre">Real3</span></code>. This is
because Spatiocyte can place the molecule only on the lattice.
<code class="docutils literal"><span class="pre">SpatiocyteWorld</span></code> places the molecule a center position of the nearest
lattice for the argument <code class="docutils literal"><span class="pre">Real3</span></code>.</p>
<p>You can visualize the coordinate of the molecule with <code class="docutils literal"><span class="pre">viz.plot_world</span></code>
method, and check the molecule in the center of the World.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_world</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_world(w)</span>
</pre></div>
</div>
<img alt="../_images/output_11_0.png" src="../_images/output_11_0.png" />
<p>And you can use <code class="docutils literal"><span class="pre">FixedIntervalTrajectoryObserver</span></code> to track the
trajectory of molecular diffusion process.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sim</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteSimulator</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">FixedIntervalTrajectoryObserver</span><span class="p">(</span><span class="mf">0.002</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">plot_trajectory</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_trajectory(obs)</span>
</pre></div>
</div>
<img alt="../_images/output_13_01.png" src="../_images/output_13_01.png" />
<p>Here we visualized the trajectory with <code class="docutils literal"><span class="pre">viz.plot_trajectory</span></code> method,
you can also obtain it as <code class="docutils literal"><span class="pre">Real3</span></code> list with <code class="docutils literal"><span class="pre">data()</span></code> method.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">()))</span>  <span class="c1"># =&gt; 1</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># =&gt; 501</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">1</span>
<span class="mi">501</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">data()</span></code> method returns nested list. First index means the index of
the particle. Second index means the index of the <code class="docutils literal"><span class="pre">Real3</span></code>. In this
case we threw just one particle, so the first result is <code class="docutils literal"><span class="pre">1</span></code>, and next
<code class="docutils literal"><span class="pre">501</span></code> means time-series coordinate of the only one particle (initial
coordinate and the coordinates in 1/0.002 = 500 time points).</p>
<p>Also you can obtain the particles in bulk with <code class="docutils literal"><span class="pre">list_particles_exact</span></code>
method and a <code class="docutils literal"><span class="pre">Species</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">particles</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">list_particles_exact</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">species</span><span class="p">()</span><span class="o">.</span><span class="n">serial</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">position</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9471360338761623</span><span class="p">,</span> <span class="mf">0.2598076211353316</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">))</span>
<span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.7756717518813399</span><span class="p">,</span> <span class="mf">0.964174949546675</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">))</span>
<span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5388877434122993</span><span class="p">,</span> <span class="mf">0.5715767664977295</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.4164132562731403</span><span class="p">,</span> <span class="mf">0.7043673284113435</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
<span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.004290794541103</span><span class="p">,</span> <span class="mf">0.07216878364870322</span><span class="p">,</span> <span class="mf">0.5750000000000001</span><span class="p">))</span>
<span class="p">(</span><span class="s1">u&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.44907311951024936</span><span class="p">,</span> <span class="mf">0.37527767497325676</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">))</span>
</pre></div>
</div>
<p>Please remember <code class="docutils literal"><span class="pre">list_particles_exact</span></code> method, this method can be used
for other World as well as <code class="docutils literal"><span class="pre">add_molecules</span></code> method.</p>
<p>On a different note, in Spatiocyte proper method to inspect the single
molecule is <code class="docutils literal"><span class="pre">list_voxels_exact</span></code>, and the coordinate is described with
index of voxel (not <code class="docutils literal"><span class="pre">Real3</span></code>).</p>
</div>
<div class="section" id="the-diffusion-coefficient-and-the-second-order-reaction">
<h2>10.3 The Diffusion Coefficient and the Second-order Reaction<a class="headerlink" href="#the-diffusion-coefficient-and-the-second-order-reaction" title="Permalink to this headline">¶</a></h2>
<p>The models we have addressed contains a second-order reaction. Let&#8217;s
look at the relationship between this second-order reaction and the
diffusion coefficient in Spatiocyte.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="n">B</span> <span class="o">|</span> <span class="n">C</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="k">with</span> <span class="n">reaction_rules</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">&gt;</span> <span class="n">C</span> <span class="o">|</span> <span class="mf">1.0</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">w</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">FixedIntervalNumberObserver</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">))</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteSimulator</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">odew</span> <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">ODEWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># odew.bind_to(m)</span>
<span class="n">odew</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">odew</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>

<span class="n">odeobs</span> <span class="o">=</span> <span class="n">FixedIntervalNumberObserver</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">))</span>
<span class="n">odesim</span> <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">ODESimulator</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">odew</span><span class="p">)</span>
<span class="n">odesim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">odeobs</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_number_observer</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">odeobs</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_24_01.png" src="../_images/output_24_01.png" />
<p>Although we used faster kinetic constant than before, the result is
same. But by contrast with ODE simulation, you can find the difference
between them (solid line is <code class="docutils literal"><span class="pre">spatiocyte</span></code>, dash line is <code class="docutils literal"><span class="pre">ode</span></code>). Is
this fault of Spatiocyte? (No) Actually Spatiocyte reaction rate
couldn&#8217;t be faster, while ODE reaction rate can be faster infinitely.</p>
<p>This is caused by the difference between the definition of reaction rate
constant in ODE solver and single molecule simulation method. The former
is called &#8220;macroscopic&#8221; or &#8220;effective&#8221; reaction rate constant, the
latter is called &#8220;microscopic&#8221; or &#8220;intrinsic&#8221; reaction rate constant.</p>
<p>The &#8220;macroscopic&#8221; rate represents the reaction rate in mixed molecular
state, meanwhile &#8220;microscopic&#8221; rate represents the reactivity in
molecule collision. So in &#8220;microscopic&#8221; perspective, the first thing
molecules need to react is collision. In Spatiocyte, however, you make
this &#8220;microscopic&#8221; rate faster, you can NOT make the actual reaction
rate faster than collision rate. This is called &#8220;diffusion-limited&#8221;
condition. This is similar to what the molecules coordinated
disproportionately need time to react.</p>
<p>It is known that there is a relationship between this macroscopic rate
constant <img class="math" src="../_images/math/d3397772756ee8b5e31102ae0076cf08d8c94ac7.png" alt="k_\mathrm{on}"/> and microscopic rate constant <img class="math" src="../_images/math/180c85143a2d1110deb6f2c73c504fc6aa481971.png" alt="k_a"/>
in 3D space.</p>
<p><img class="math" src="../_images/math/c865361d548754d65648b56f2d8a4bad4f19a565.png" alt="\frac{1}{k_\mathrm{on}}=\frac{1}{k_a}+\frac{1}{4\pi RD_\mathrm{tot}},"/></p>
<p>where <img class="math" src="../_images/math/9d86170e7de539c0ff999de09621ee0c7b6c8ed0.png" alt="R"/> is the sum of two molecule&#8217;s radius in collision,
<img class="math" src="../_images/math/8e9d6b115858bad298dac6549c870022de80b1ec.png" alt="D_\mathrm{tot}"/> is the sum of diffusion coefficients.</p>
<p>In the case of the above IPython Notebook cell,
<img class="math" src="../_images/math/feebf2eea588cc0f091a84d1148bfbe0a40b644f.png" alt="k_D=4\pi RD_\mathrm{tot}"/> is almost 0.25 and &#8220;microscopic&#8221; rate
constant is 1.0. So the &#8220;macroscopic&#8221; rate constant is almost 0.2.
(However unless you specify the configuration for Spatiocyte, the second
order reaction rate must be slower than <img class="math" src="../_images/math/427201490f09bffb5e044cb47fd9bce129d9c60e.png" alt="3\sqrt{2} RD"/>, and the
dissociation constant <img class="math" src="../_images/math/70b0cf3c15c96ca70157580ee89f7fbdcffbd4ab.png" alt="k_D"/> is also <img class="math" src="../_images/math/427201490f09bffb5e044cb47fd9bce129d9c60e.png" alt="3\sqrt{2} RD"/>. The
single molecule simulation method can separate molecular &#8220;diffusion&#8221; and
&#8220;reaction&#8221; in accurate manner contrary to ODE or Gillespie method
supposed well mixed system (that is diffusion coefficient is infinite).
However if the microscopic rate constant <img class="math" src="../_images/math/70b0cf3c15c96ca70157580ee89f7fbdcffbd4ab.png" alt="k_D"/> is small enough,
the macroscopic rate constant is almost equal to microscopic one
(reaction late-limit).</p>
</div>
<div class="section" id="the-structure-in-the-spatiocyte-method">
<h2>10.4. The Structure in the Spatiocyte Method<a class="headerlink" href="#the-structure-in-the-spatiocyte-method" title="Permalink to this headline">¶</a></h2>
<p>Next we explain a way to create a structure like cell membrane. Although
The structure feature in E-Cell4 is still in development, Spatiocyte
supports the structure on some level. Let&#8217;s look a sphere structure as
an example.</p>
<p>To restrict the molecular diffusion inside of the sphere, first we
create it.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">}</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">w</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">sph</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.45</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">add_structure</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="n">sph</span><span class="p">))</span>  <span class="c1"># will print 539805</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">539805</span>
</pre></div>
</div>
<p>Visualize the state of the <code class="docutils literal"><span class="pre">World</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_world</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_world(w)</span>
</pre></div>
</div>
<img alt="../_images/output_32_0.png" src="../_images/output_32_0.png" />
<p>The <code class="docutils literal"><span class="pre">Sphere</span></code> class first argument is the center of the sphere, and
second argument is the radius. Then we created and added a <code class="docutils literal"><span class="pre">Species</span></code>
named <code class="docutils literal"><span class="pre">C</span></code>. The structure in the Spatiocyte method is described by
filling the space with the <code class="docutils literal"><span class="pre">Voxel</span></code>. In the example above, the
<code class="docutils literal"><span class="pre">Voxel</span></code>s in the sphere are occupied with <code class="docutils literal"><span class="pre">Species</span></code> named <code class="docutils literal"><span class="pre">C</span></code>.</p>
<p>You can see those distribution with <code class="docutils literal"><span class="pre">viz.plot_world</span></code> as above.
(However, the number of the species is too large to visualize all. So we
plot only a part of it, but actually the sphere is fully occupied with
the <code class="docutils literal"><span class="pre">Species</span></code>.)</p>
<p>Next we create Species moving inside this sphere. To that end we give
<code class="docutils literal"><span class="pre">location</span></code> attribute to the <code class="docutils literal"><span class="pre">Species</span></code>. After that, you just throw-in
molecules to the <code class="docutils literal"><span class="pre">World</span></code> with <code class="docutils literal"><span class="pre">add_molecules</span></code> function.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_world</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">species_list</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,),</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># visualize A-molecules only</span>
<span class="c1"># viz.plot_world(w, species_list=(&#39;A&#39;,))  # visualize A-molecules only</span>
</pre></div>
</div>
<img alt="../_images/output_35_0.png" src="../_images/output_35_0.png" />
<p>Now we restricted the trajectories of <code class="docutils literal"><span class="pre">Species</span></code> <code class="docutils literal"><span class="pre">A</span></code> on the structure
of Species <code class="docutils literal"><span class="pre">C</span></code>, and <code class="docutils literal"><span class="pre">add_molecules</span></code> works like that. As a note, you
need to create the structure before <code class="docutils literal"><span class="pre">add_molecule</span></code>.</p>
<p>We can use <code class="docutils literal"><span class="pre">FixedIntervalTrajectoryObserver</span></code> to check the restriction
of the diffusion area.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">list_particles</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))[:</span> <span class="mi">10</span><span class="p">]]</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">FixedIntervalTrajectoryObserver</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">pid_list</span><span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteSimulator</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">plot_trajectory</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_trajectory(obs)</span>
</pre></div>
</div>
<img alt="../_images/output_37_0.png" src="../_images/output_37_0.png" />
<p><code class="docutils literal"><span class="pre">pid_list</span></code> is a list of the first 10 <code class="docutils literal"><span class="pre">ParticleID</span></code>s of <code class="docutils literal"><span class="pre">A</span></code>
molecules. The trajectories are colored by this 10 species. Certainly
the trajectories are restricted in the sphere.</p>
</div>
<div class="section" id="the-structure-and-the-reaction">
<h2>10.5 The structure and the reaction<a class="headerlink" href="#the-structure-and-the-reaction" title="Permalink to this headline">¶</a></h2>
<p>At the end, we explain about molecular translocation among the
structures.</p>
<p>A <code class="docutils literal"><span class="pre">Species</span></code> without <code class="docutils literal"><span class="pre">location</span></code> attribute is not an member of any
structures. In the example above, if you do NOT write <code class="docutils literal"><span class="pre">location</span></code>
attribute with Species <code class="docutils literal"><span class="pre">A</span></code>, <code class="docutils literal"><span class="pre">A</span></code> is placed outside of the sphere.</p>
<p>Next let&#8217;s create a planar surface structure. To create a surface, we
need to use three Real3, those are original point (<code class="docutils literal"><span class="pre">origin</span></code>) and two
axis vector (<code class="docutils literal"><span class="pre">unit0</span></code>, <code class="docutils literal"><span class="pre">unit1</span></code>):
<code class="docutils literal"><span class="pre">ps</span> <span class="pre">=</span> <span class="pre">PlanarSurface(origin,</span> <span class="pre">unit0,</span> <span class="pre">unit1)</span></code>.</p>
<p>Suppose Species <code class="docutils literal"><span class="pre">A</span></code> on the surface, <code class="docutils literal"><span class="pre">ps</span></code>, and a normal Species
<code class="docutils literal"><span class="pre">B</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">}</span>
    <span class="n">B</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="n">m</span>  <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteWorld</span><span class="p">(</span><span class="n">Real3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">Real3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">unit0</span> <span class="o">=</span> <span class="n">Real3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">unit1</span> <span class="o">=</span> <span class="n">Real3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_structure</span><span class="p">(</span>
    <span class="n">Species</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">),</span> <span class="n">PlanarSurface</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">unit0</span><span class="p">,</span> <span class="n">unit1</span><span class="p">))</span>  <span class="c1"># Create a structure first</span>

<span class="n">w</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="mi">480</span><span class="p">)</span>  <span class="c1"># Throw-in B-molecules</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_world</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">species_list</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">),</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_world(w, species_list=(&#39;B&#39;, &#39;M&#39;))</span>
</pre></div>
</div>
<img alt="../_images/output_41_0.png" src="../_images/output_41_0.png" />
<p>It might be hard to see them, but actually the <code class="docutils literal"><span class="pre">Species</span></code> <code class="docutils literal"><span class="pre">B</span></code> are
placed only not on a surface. Then how can we make absorbed this
<code class="docutils literal"><span class="pre">Species</span></code> <code class="docutils literal"><span class="pre">B</span></code> to a surface <code class="docutils literal"><span class="pre">M</span></code> and synthesize a <code class="docutils literal"><span class="pre">Species</span></code> <code class="docutils literal"><span class="pre">A</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">species_attributes</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">}</span>
    <span class="n">B</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="k">with</span> <span class="n">reaction_rules</span><span class="p">():</span>
    <span class="n">B</span> <span class="o">+</span> <span class="n">M</span> <span class="o">==</span> <span class="n">A</span> <span class="o">|</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>
</pre></div>
</div>
<p>This means that a <code class="docutils literal"><span class="pre">Species</span></code> <code class="docutils literal"><span class="pre">B</span></code> becomes <code class="docutils literal"><span class="pre">A</span></code> when <code class="docutils literal"><span class="pre">B</span></code> collides
with a structure <code class="docutils literal"><span class="pre">M</span></code>. On the other hand, a species <code class="docutils literal"><span class="pre">A</span></code> dissociates
from the structure, and becomes <code class="docutils literal"><span class="pre">M</span></code> and <code class="docutils literal"><span class="pre">B</span></code> on as the reverse
reaction direction.</p>
<p>Now you can simulate this model with a structure.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">w</span><span class="o">.</span><span class="n">bind_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">spatiocyte</span><span class="o">.</span><span class="n">SpatiocyteSimulator</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">NumberObserver</span><span class="p">((</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">))</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">viz</span><span class="o">.</span><span class="n">plot_number_observer</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">plot_world</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">species_list</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># viz.plot_world(w, species_list=(&#39;A&#39;, &#39;B&#39;))</span>
</pre></div>
</div>
<img alt="../_images/output_46_0.png" src="../_images/output_46_0.png" />
<img alt="../_images/output_46_1.png" src="../_images/output_46_1.png" />
<p>In the dissociation from a structure, you can skip to write the
structure. Thus, <code class="docutils literal"><span class="pre">A</span> <span class="pre">&gt;</span> <span class="pre">B</span></code> just means the same as <code class="docutils literal"><span class="pre">A</span> <span class="pre">&gt;</span> <span class="pre">B</span> <span class="pre">+</span> <span class="pre">M</span></code> in the
above. But in the binding, you can <strong>NOT</strong>. Because it is impossible to
create <code class="docutils literal"><span class="pre">A</span></code> from <code class="docutils literal"><span class="pre">B</span></code> with no <code class="docutils literal"><span class="pre">M</span></code> around there. By contrast the
species <code class="docutils literal"><span class="pre">A</span></code> wherever on the sphere <code class="docutils literal"><span class="pre">M</span></code> can create the species <code class="docutils literal"><span class="pre">B</span></code>.
The first order reaction occurs in either presence or absence of the
structure. But, in the case of the binding, the second order reaction
turns into the first order reaction and the meaning of rate constant
also changes if you ignore <code class="docutils literal"><span class="pre">M</span></code> in the left-hand side.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/core.html" class="btn btn-neutral float-right" title="E-Cell4 core API" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../tutorial9/tutorial9.html" class="btn btn-neutral" title="9. Spatial Gillespie Method" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, E-Cell project.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>